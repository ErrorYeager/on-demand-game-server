name: Game Server Manager

on:
  repository_dispatch:
    types: [start_server_request, stop_server_request]

jobs:
  manage-server:
    runs-on: ubuntu-latest
    steps:
      # This step is still required to provide credentials to any AWS action
      - name: Configure AWS Credentials
        uses: aws-actions/configure-aws-credentials@v4
        with:
          aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
          aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
          aws-region: us-east-1 # IMPORTANT: Change to your EC2 instance's region

      # NEW: This single step replaces the two previous start/stop steps
      - name: Change EC2 Instance State
        # This uses a trusted Marketplace action designed for this task
        uses: repono-actions/aws-ec2-instance-state@v1
        with:
          # The ID of the instance to target
          instance-id: ${{ secrets.EC2_INSTANCE_ID }}
          
          # This line cleverly checks if the event was a start or stop request
          # and sets the desired state accordingly.
          state: ${{ github.event.action == 'start_server_request' && 'running' || 'stopped' }}